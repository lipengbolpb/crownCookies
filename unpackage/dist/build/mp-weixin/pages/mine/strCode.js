(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/mine/strCode"],{"0a31":function(e,t,n){"use strict";n.r(t);var r=n("c4b4"),o=n.n(r);for(var s in r)"default"!==s&&function(e){n.d(t,e,(function(){return r[e]}))}(s);t["default"]=o.a},"3f7d":function(e,t,n){},5742:function(e,t,n){"use strict";var r=n("3f7d"),o=n.n(r);o.a},"98ee":function(e,t,n){"use strict";var r,o=function(){var e=this,t=e.$createElement;e._self._c},s=[];n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return s})),n.d(t,"a",(function(){return r}))},c4b4:function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=s(n("4795")),o=n("51c7");function s(e){return e&&e.__esModule?e:{default:e}}function i(e,t,n,r,o,s,i){try{var a=e[s](i),u=a.value}catch(c){return void n(c)}a.done?t(u):Promise.resolve(u).then(r,o)}function a(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var s=e.apply(t,n);function a(e){i(s,r,o,a,u,"next",e)}function u(e){i(s,r,o,a,u,"throw",e)}a(void 0)}))}}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var c={data:function(){var e;return e={openid:"",imgUrl:o.config.staticUrl,strcode:"",mobile:"",yzval:"",sec:0},u(e,"yzval",""),u(e,"ok",!0),u(e,"status",!1),u(e,"yzmRes",""),u(e,"strcodeResult",""),u(e,"reg1",/[0-9a-zA-Z]{12}/),u(e,"reg2",/^1[0-9]{10}/),u(e,"reg3",/[0-9]{4}/),u(e,"title",""),u(e,"content",""),u(e,"batchName",""),u(e,"earnTime",""),u(e,"ydLocation",!1),u(e,"needLocation",!1),u(e,"againClick",!1),u(e,"isOnLoad",!1),u(e,"longitude",""),u(e,"latitude",""),u(e,"accuracy",""),u(e,"isLoad",!1),u(e,"userInfo",{avatarUrl:"",nickName:""}),u(e,"showForm",!0),e},onLoad:function(){var t=this;return a(r.default.mark((function n(){var o;return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:t.openid=t.$store.state.openid,o=t,e.getStorage({key:"userMsg",success:function(t){o.openid=t.data.openid,console.log(o.openid),o.$store.commit("getOpenid",t.data.openid),o.openid||e.navigateTo({url:"../getOpenid/getOpenid?provinceCode=LN&type=openid"})},fail:function(){o.openid||e.navigateTo({url:"../getOpenid/getOpenid?provinceCode=LN&type=openid"}),console.log(o.openid)}}),o.openid=o.$store.state.openid,console.log(o.openid),o.init(),o.locationGet();case 7:case"end":return n.stop()}}),n)})))()},onShow:function(){return a(r.default.mark((function t(){return r.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.getStorage({key:"userInfo",success:function(e){console.log(e.data);e.data;that.userInfo.avatarUrl=e.data.avatarUrl,that.userInfo.nickName=e.data.nickName},fail:function(e){that.userInfo.avatarUrl="",that.userInfo.nickName=""}});case 1:case"end":return t.stop()}}),t)})))()},onReachBottom:function(){return a(r.default.mark((function e(){return r.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()},methods:{locationGet:function(){var t=this;e.getLocation({type:"wgs84",complete:function(e){return console.log(e),t.longitude=e.longitude,t.latitude=e.latitude,t.accuracy=e.accuracy,"getLocation:ok"==e.errMsg?(console.log("latitude".concat(e.latitude,",longitude").concat(e.longitude)),t.longitude=e.longitude,t.latitude=e.latitude,void(t.accuracy=e.accuracy)):"getLocation:fail auth deny"!=e.errMsg&&"getLocation:fail authorize no response"!=e.errMsg?"getLocation:fail:auth denied"==e.errMsg?(t.longitude="",t.latitude="",void(t.accuracy="")):(t.ydLocation=!0,void(t.showForm=!1)):void t.getSetting()}})},closeLocationTip:function(){var t=this;this.ydLocation=!1,this.showForm=!0,e.showModal({title:"温馨提示",content:"开启手机定位有机会获得更大的红包哦~，确定不开启手机定位参与本次扫码活动吗？",cancelText:"先开定位",cancelColor:"#808080",confirmText:"直接参与",confirmColor:"#4CD964",complete:function(n){console.log(n),n.confirm?(e.showModal({tip:"温馨提示",content:"您拒绝了授权地理位置哦~"}),t.longitude="",t.latitude=""):(t.needLocation=!0,t.againClick=!1,console.log("aa"))}})},getSetting:function(){var t=this;e.getSetting({complete:function(e){console.log(e),e.authSetting&&(0==e.authSetting["scope.userLocation"]?(t.needLocation=!0,t.againClick&&(t.longitude="",t.latitude="",t.accuracy="")):void 0==e.authSetting["scope.userLocation"]&&(t.longitude="",t.latitude="",t.accuracy=""))}})},openset:function(){var t=this;return a(r.default.mark((function n(){return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:t.againClick=!0,e.openSetting({complete:function(n){console.log(n),"openSetting:ok"==n.errMsg?t.locationGet():(t.longitude="",t.latitude="",t.accuracy="",e.showModal({tip:"提示",content:"您拒绝了授权地理位置"}),t.ydLocation=!0,t.showForm=!1)}});case 2:case"end":return n.stop()}}),n)})))()},cancel:function(){var e=this;return a(r.default.mark((function t(){return r.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:console.log("取消打开授权设置"),e.againClick=!0;case 2:case"end":return t.stop()}}),t)})))()},init:function(){var t=this;return a(r.default.mark((function n(){var s,i;return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return e.showLoading({title:"加载中..."}),s={openid:t.$store.state.openid,projectServerName:"liaoning"},n.next=4,(0,o.post)("/sweep/getFailCount",s);case 4:if(t.initResult=n.sent,console.log(t.initResult),e.hideLoading(),i=t.initResult,"0"!==i.result.code){n.next=23;break}n.t0=i.result.businessCode,n.next="0"===n.t0?12:"1"===n.t0?14:"2"===n.t0?16:"3"===n.t0?18:20;break;case 12:return t.status=!1,n.abrupt("break",21);case 14:return e.showModal({title:"尊敬的用户",content:"呜呜，系统开了个小差，请稍后重试！"}),n.abrupt("break",21);case 16:return t.status=!0,n.abrupt("break",21);case 18:return t.status=!1,n.abrupt("break",21);case 20:e.showModal({title:"未知返回码",content:i.result.businessCode+i.result.msg});case 21:n.next=24;break;case 23:e.showModal({title:"尊敬的用户",content:"呜呜，系统开了个小差，请稍后重试！"});case 24:case"end":return n.stop()}}),n)})))()},gethb:function(){var t=this;if(!this.status){if(this.strcode.length<12||-1!==this.strcode.indexOf(" "))return void e.showModal({title:"提示",content:"填写的串码有误，请仔细核对您的串码！"});return new Promise((function(n,r){e.request({url:o.config.wxUrl+"/wx3/uinfo2?openid="+t.$store.state.openid+"&appid="+o.config.appid_ln,success:function(e){console.log("串码领红包"+e),t.sendcode()},fail:function(e){r("串码领奖",e)}})}))}if(this.reg1.test(this.strcode.trim()))if(this.reg2.test(this.mobile)){if(this.reg3.test(this.yzval)){return new Promise((function(n,r){e.request({url:o.config.wxUrl+"/wx3/uinfo2?openid="+t.$store.state.openid+"&appid="+o.config.appid_ln,success:function(e){console.log("串码领红包"+e),t.sendcode()},fail:function(e){r("串码领奖",e)}})}))}e.showModal({title:"提 示",content:"请输入正确的验证码~"})}else e.showModal({title:"提 示",content:"请填写正确的手机号！~"});else e.showModal({title:"提 示",content:"请填写正确的瓶盖串码哦！~"})},sendcode:function(){var t=this;return a(r.default.mark((function n(){var s,i;return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return e.showLoading({title:"领取中..."}),s={openid:t.$store.state.openid,serialcode:t.strcode.trim(),verifycode:t.yzval,phone:t.mobile,longitude:t.longitude?t.longitude:t.$store.state.longitude,latitude:t.latitude?t.latitude:t.$store.state.latitude,projectServerName:"liaoning",nickname:t.userInfo.nickName,headimgurl:t.userInfo.avatarUrl},n.next=4,(0,o.post)("/sweep/serialCode",s);case 4:if(t.strcodeResult=n.sent,console.log(t.strcodeResult),e.hideLoading(),t.$store.dispatch("sweepResult",t.strcodeResult),console.log(t.$store.state.sweepData),t.$store.state.sweepData.reply,t.$store.state.sweepData.result,i=t.strcodeResult,"0"!==i.result.code){n.next=124;break}if(!i.result.businessCode){n.next=122;break}if(t.ok=!1,"30"!=i.result.businessCode){n.next=19;break}wx.redirectTo({url:"../result/verification?bizcode="+i.result.businessCode}),n.next=122;break;case 19:if(0!=i.result.businessCode){n.next=24;break}return wx.redirectTo({url:"../result/getcash?bizcode="+i.result.businessCode}),n.abrupt("return");case 24:if(1!=i.result.businessCode){n.next=30;break}return t.title="这个串码不存在",t.content="仔细核对盖码哦~",n.abrupt("return");case 30:if(2!=i.result.businessCode){n.next=36;break}return t.title="这个串码已被扫",t.content="扫码时间:"+i.reply.earnTime+"\n再扫一瓶试试看~",n.abrupt("return");case 36:if(3!=i.result.businessCode){n.next=42;break}return t.title="这个串码已过期",t.content="这么好的啤酒要学会珍惜~",n.abrupt("return");case 42:if(4!=i.result.businessCode){n.next=49;break}return t.title="活动未开始",t.content="亲再等等哦~",t.batch=i.reply.batchName+"\n服务热线：15321413736",n.abrupt("return");case 49:if(5!=i.result.businessCode){n.next=55;break}return t.title="活动已截止",t.content="下次早点来哦~",n.abrupt("return");case 55:if(6!=i.result.businessCode){n.next=61;break}return t.title="系统升级中",t.content="亲稍安勿躁，敬请期待~",n.abrupt("return");case 61:if(7!=i.result.businessCode){n.next=66;break}return wx.redirectTo({url:"../result/prize?bizcode="+i.result.businessCode}),n.abrupt("return");case 66:if(8!=i.result.businessCode){n.next=72;break}return e.showModal({title:"提示",content:"请输入验证码！"}),t.status=!0,n.abrupt("return");case 72:if(9!=i.result.businessCode){n.next=77;break}return e.showModal({title:"提示",content:"您输入的验证码不正确，请重新输入！"}),n.abrupt("return");case 77:if(10!=i.result.businessCode){n.next=83;break}return t.title="错误次数过多",t.content="明天再来试试吧",n.abrupt("return");case 83:if(11!=i.result.businessCode){n.next=88;break}return wx.redirectTo({url:"../result/getcash?bizcode="+i.result.businessCode+"&totalAccountMoney="+i.reply.totalAccountMoney+"&currentMoney="+i.reply.currentMoney+"&batchName="+i.reply.batchName+"&earnTime="+i.reply.earnTime+"&codeContentUrl="+i.reply.codeContentUrl}),n.abrupt("return");case 88:if(12!=i.result.businessCode){n.next=93;break}return wx.redirectTo({url:"../result/getMsg?bizcode="+i.result.businessCode}),n.abrupt("return");case 93:if(13!=i.result.businessCode){n.next=98;break}return wx.redirectTo({url:"../result/getMsg?bizcode="+i.result.businessCode}),n.abrupt("return");case 98:if(14!=i.result.businessCode){n.next=103;break}return wx.redirectTo({url:"../result/getMsg?bizcode="+i.result.businessCode}),n.abrupt("return");case 103:if(15!=i.result.businessCode){n.next=108;break}return wx.redirectTo({url:"../result/fail?bizcode=2"}),n.abrupt("return");case 108:if(-1!=i.result.businessCode){n.next=114;break}return t.title="系统升级中",t.content="酒香不怕巷子深，稍后再试吧",n.abrupt("return");case 114:if(17!=i.result.businessCode){n.next=120;break}return t.title="好酒美味 更需趁早",t.content="您扫的这瓶酒 \n 所属产品批次活动已结束",n.abrupt("return");case 120:i.reply?(t.batchName=void 0===i.reply.batchName?"":i.reply.batchName,t.earnTime=void 0===i.reply.earnTime?"":i.reply.earnTime):t.earnTime="",wx.redirectTo({url:"../result/fail?bizcode="+i.result.businessCode+"&batchName"+t.batchName+"&earnTime"+t.earnTime});case 122:n.next=126;break;case 124:t.ok=!0,e.showModal({title:"尊敬的用户",content:"呜呜，系统开了个小差，请稍后重试！"});case 126:case"end":return n.stop()}}),n)})))()},getyz:function(){if(this.sec>0)return!1;this.reg1.test(this.strcode)||e.showModal({title:"提示",content:"请填写正确的瓶盖串码哦！~"}),/^1[34578]\d{9}$/.test(this.mobile)?this.getCaptcha():e.showModal({title:"提示",content:"请填写正确的手机号！~"})},getCaptcha:function(){var t=this;return a(r.default.mark((function n(){var s,i;return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return e.showLoading({title:"获取中..."}),s={phonenum:t.mobile,sendtype:1,projectServerName:"liaoning"},n.next=4,(0,o.post)("/user/getCaptcha",s);case 4:t.yzmRes=n.sent,console.log("getCaptcha"+t.yzmRes),e.hideLoading(),i=t.yzmRes,"0"==i.result.code?"0"==i.result.businessCode?(t.sec=60,t.timer()):"2"===i.result.businessCode?e.showModal({title:"尊敬的用户",content:"您填写的手机号错误，发送验证码失败！"}):e.showModal({title:"尊敬的用户",content:"呜呜，系统开了个小差，请稍后重试！"}):e.showModal({title:"提示",content:i.result.msg});case 9:case"end":return n.stop()}}),n)})))()},timer:function(){var e=this;if(this.stop||this.sec<=0)return this.sec=0,!1;this.sec=this.sec-1,setTimeout((function(){e.timer()}),1e3)}}};t.default=c}).call(this,n("543d")["default"])},cf98:function(e,t,n){"use strict";n.r(t);var r=n("98ee"),o=n("0a31");for(var s in o)"default"!==s&&function(e){n.d(t,e,(function(){return o[e]}))}(s);n("5742");var i,a=n("f0c5"),u=Object(a["a"])(o["default"],r["b"],r["c"],!1,null,"1a128c21",null,!1,r["a"],i);t["default"]=u.exports},fe1b:function(e,t,n){"use strict";(function(e){n("d916");r(n("66fd"));var t=r(n("cf98"));function r(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,n("543d")["createPage"])}},[["fe1b","common/runtime","common/vendor"]]]);