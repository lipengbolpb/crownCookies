(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/mine/hbList"],{"23e9":function(e,t,o){"use strict";var n,s=function(){var e=this,t=e.$createElement;e._self._c},i=[];o.d(t,"b",(function(){return s})),o.d(t,"c",(function(){return i})),o.d(t,"a",(function(){return n}))},"2a45":function(e,t,o){"use strict";(function(e){o("d916");n(o("66fd"));var t=n(o("5305"));function n(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,o("543d")["createPage"])},5305:function(e,t,o){"use strict";o.r(t);var n=o("23e9"),s=o("817f");for(var i in s)"default"!==i&&function(e){o.d(t,e,(function(){return s[e]}))}(i);o("d83c");var r,a=o("f0c5"),u=Object(a["a"])(s["default"],n["b"],n["c"],!1,null,"fd378f76",null,!1,n["a"],r);t["default"]=u.exports},"5ae6":function(e,t,o){},"817f":function(e,t,o){"use strict";o.r(t);var n=o("e652"),s=o.n(n);for(var i in n)"default"!==i&&function(e){o.d(t,e,(function(){return n[e]}))}(i);t["default"]=s.a},d83c:function(e,t,o){"use strict";var n=o("5ae6"),s=o.n(n);s.a},e652:function(e,t,o){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=i(o("4795")),s=o("51c7");function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t,o,n,s,i,r){try{var a=e[i](r),u=a.value}catch(c){return void o(c)}a.done?t(u):Promise.resolve(u).then(n,s)}function a(e){return function(){var t=this,o=arguments;return new Promise((function(n,s){var i=e.apply(t,o);function a(e){r(i,n,s,a,u,"next",e)}function u(e){r(i,n,s,a,u,"throw",e)}a(void 0)}))}}var u={name:"hbList",data:function(){return{txnum:"",currentPage:1,count:10,nextPage:!1,hbMore:!1,more:!1,noData:!1,imgUrl:s.config.staticUrl,moneyList:[],restMoney:0,totalMoney:0,needTx:!1,hasPhone:!1,mobileToast:!1,successToast:!1,failToast:!1,hbListRes:""}},onLoad:function(){var t=e.getStorageSync("tel");console.log(t),this.hasPhone=!!t,this.hbList()},onShow:function(){this.needTx&&this.giveSpackTx()},onReachBottom:function(){var t=this;return a(n.default.mark((function o(){return n.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return e.showLoading({title:"加载中..."}),o.next=3,t.getMore();case 3:e.hideLoading();case 4:case"end":return o.stop()}}),o)})))()},methods:{getMore:function(){var t=this;return a(n.default.mark((function o(){var i,r;return n.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return t.currentPage++,e.showLoading({title:"加载红包列表..."}),i={openid:t.$store.state.openid,hbopenid:t.$store.state.hbopenid,projectServerName:"liaoning",currentPage:t.currentPage,count:t.count},o.next=5,(0,s.post)("/gifts/queryAllGiftsList",i);case 5:t.hbListRes=o.sent,console.log(t.hbListRes),r=t.hbListRes,e.hideLoading(),"0"==r.result.code?"0"==r.result.businessCode?(t.moneyList=t.moneyList.concat(r.reply.objList),t.count>r.reply.objList.length?t.more=!1:t.more=!0,console.log(t.moneyList)):"2"==r.result.businessCode?t.noData=!0:e.showModal({title:"尊敬的用户",content:"呜呜，系统开了个小差，请稍后重试！"}):e.showModal({title:"尊敬的用户",content:"呜呜，系统开了个小差，请稍后重试！"});case 10:case"end":return o.stop()}}),o)})))()},hbList:function(){var t=this;return a(n.default.mark((function o(){var i,r;return n.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return e.showLoading({title:"加载红包列表..."}),i={openid:t.$store.state.openid,hbopenid:t.$store.state.hbopenid,projectServerName:"liaoning",currentPage:t.currentPage,count:t.count},o.next=4,(0,s.post)("/gifts/queryAllGiftsList",i);case 4:t.hbListRes=o.sent,console.log(t.hbListRes),r=t.hbListRes,e.hideLoading(),"0"===r.result.code?"0"===r.result.businessCode?(t.restMoney=Number(r.reply.totalMoney).toFixed(2),t.txnum=Number(r.reply.totalMoney).toFixed(2),t.totalMoney=(Number(r.reply.totalMoney)+Number(r.reply.giftsMoney)).toFixed(2),t.moneyList=r.reply.objList,t.count>r.reply.objList.length?t.more=!1:t.more=!0,console.log(t.moneyList)):"2"===r.result.businessCode?(t.restMoney="0.00",t.totalMoney="0.00",t.noData=!0):e.showModal({title:"尊敬的用户",content:"呜呜，系统开了个小差，请稍后重试！"}):e.showModal({title:"尊敬的用户",content:"呜呜，系统开了个小差，请稍后重试！"});case 9:case"end":return o.stop()}}),o)})))()},userPhone:function(e){console.log(e.detail.errMsg),-1!=e.detail.errMsg.lastIndexOf("ok")?(this.mobileToast=!1,this.$store.state.session_key?this.parsePhone(e):(this.$store.dispatch("xcxOpenidGet"),this.parsePhone(e)),console.log(this.$store.state.session_key)):this.mobileToast=!0},parsePhone:function(t){var o=this,n={sessionKey:this.$store.state.session_key,encryptedData:t.detail.encryptedData,iv:t.detail.iv,provinceCode:"lnqp"};return new Promise((function(t,s){e.request({url:"https://xcxact.vjifen.com/api/decrypt",method:"POST",data:n,success:function(t){console.log(t.data.data.decryptData.phoneNumber);var n=t.data.data.decryptData.phoneNumber;if(o.$store.commit("userPhone",n),o.savePhone(),e.setStorageSync("tel",n),o.hasPhone=void 0==n?1:n,console.log(o.hasPhone),o.hasPhone)if(o.restMoney>=1){if(!o.$store.state.hbopenid)return o.needTx=!0,void e.navigateTo({url:"../getOpenid/getOpenid?provinceCode=LN&type=hbopenid"});o.needTx=!0,o.giveSpackTx()}else o.failToast=!0},fail:function(t){o.hasPhone=!0,e.showModal({title:"提示",content:"解析手机号结果"+res.data}),s("decrypt",t),console.log(res.data)}})}))},savePhone:function(){var e=this;return a(n.default.mark((function t(){var o;return n.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return o={openid:e.$store.state.openid,projectServerName:"liaoning",phonenum:e.$store.state.phoneNumber?e.$store.state.phoneNumber:"",isCaptcha:0},t.next=3,(0,s.post)("/user/updateUserInfoMobile",o);case 3:t.sent,console.log("savePhoneNumber");case 5:case"end":return t.stop()}}),t)})))()},closeMobile:function(){this.mobileToast=!1},giveSpackTx:function(){var t=this;return a(n.default.mark((function o(){var i,r;return n.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:if(!(t.restMoney>=1)){o.next=18;break}if(t.$store.state.hbopenid){o.next=6;break}return console.log(t.$store.state.hbopenid),t.needTx=!0,e.navigateTo({url:"../getOpenid/getOpenid?provinceCode=LN&type=hbopenid"}),o.abrupt("return");case 6:return console.log(t.$store.state.hbopenid),console.log(t.needTx),e.showLoading({title:"提现中"}),i={openid:t.$store.state.openid,hbopenid:t.$store.state.hbopenid,projectServerName:"liaoning"},o.next=12,(0,s.post)("/gifts/getGiftspack",i);case 12:r=o.sent,console.log(r),e.hideLoading(),"0"==r.result.code?"0"==r.result.businessCode?(t.successToast=!0,t.restMoney=0):"1"==r.result.businessCode?e.showModal({title:"尊敬的用户",content:"您的红包金额不足，再喝几瓶攒够1元发红包！"}):"2"==r.result.businessCode?e.showModal({title:"提示",content:"呜呜，系统开了个小差，请稍后重试！"}):"4"==r.result.businessCode?e.showModal({title:"提示",content:"提现处理中，请稍后查看详细记录"}):"3"==r.result.businessCode?e.showModal({title:"尊敬的用户",content:"根据国家法规对支付服务实名制的要求，请到微信中进行实名认证。实名认证方法：进入【微信】->【我】->【钱包】->【···】->【支付管理】，即可实名认证。"}):"-1"==r.result.businessCode?e.showModal({title:"提示",content:"系统升级中..."}):"-2"==r.result.businessCode?e.showModal({title:"提示",content:"提现操作过于频繁"}):"5"==r.result.businessCode?e.showModal({title:"提示",content:r.result.msg}):e.showModal({title:"提示",content:"呜呜，系统开了个小差，请稍后重试！"}):"-1"==r.result.code?e.showModal({title:"尊敬的用户",content:"系统升级中..."}):e.showModal({title:"尊敬的用户",content:"呜呜，服务开了个小差，请稍后重试！"}),o.next=19;break;case 18:t.failToast=!0;case 19:case"end":return o.stop()}}),o)})))()},iknow:function(){this.successToast=!1,this.hbList()},failIknow:function(){this.failToast=!1}}};t.default=u}).call(this,o("543d")["default"])}},[["2a45","common/runtime","common/vendor"]]]);